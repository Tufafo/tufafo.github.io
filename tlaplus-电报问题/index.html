<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="zh" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Tlaplus：电报问题 - 甲与</title>
<meta name="description" content="在一个小编程中测试tlaplus。">


  <meta name="author" content="甲与">
  
  <meta property="article:author" content="甲与">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="zh_CN">
<meta property="og:site_name" content="甲与">
<meta property="og:title" content="Tlaplus：电报问题">
<meta property="og:url" content="/tlaplus-%E7%94%B5%E6%8A%A5%E9%97%AE%E9%A2%98/">


  <meta property="og:description" content="在一个小编程中测试tlaplus。">



  <meta property="og:image" content="/assets/images/wallhaven-o5e1jm.png">





  <meta property="article:published_time" content="2024-03-14T00:00:00+08:00">






<link rel="canonical" href="/tlaplus-%E7%94%B5%E6%8A%A5%E9%97%AE%E9%A2%98/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "甲与",
      "url": "/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="甲与 Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">转到主导航栏</a></li>
    <li><a href="#main" class="screen-reader-shortcut">转到内容</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">转到底部</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          甲与
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/tags/">分类</a>
            </li><li class="masthead__menu-item">
              <a href="/year-archive/">归档</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">切换搜索</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">切换菜单</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      
  







<div class="page__hero"
  style=" background-image: url('');"
>
  
    <img src="/assets/images/wallhaven-o5e1jm.png" alt="Tlaplus：电报问题" class="page__hero-image">
  
  
</div>







<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  
    <div class="author__avatar">
      <a href="/">
        <img src="/assets/images/6.png" alt="甲与" itemprop="image" class="u-photo">
      </a>
    </div>
  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="/" itemprop="url">甲与</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>记录一些随想。</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">关注</button>
    <ul class="author__urls social-icons">
      

      
        
          
        
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Tlaplus：电报问题">
    <meta itemprop="description" content="在一个小编程中测试tlaplus。">
    <meta itemprop="datePublished" content="2024-03-14T00:00:00+08:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="/tlaplus-%E7%94%B5%E6%8A%A5%E9%97%AE%E9%A2%98/" class="u-url" itemprop="url">Tlaplus：电报问题
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2024-03-14T00:00:00+08:00">March 14, 2024</time>
      </span>
    

    

    
  </p>


        </header>
      

      <section class="page__content e-content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-cog"></i> 目录</h4></header>
              <ul class="toc__menu"><li><a href="#电报问题描述">电报问题描述</a></li><li><a href="#单进程建模">单进程建模</a><ul><li><a href="#单进程代码">单进程代码</a></li><li><a href="#报错情况设置">报错情况设置</a></li></ul></li><li><a href="#多进程处理">多进程处理</a><ul><li><a href="#多进程代码">多进程代码</a></li><li><a href="#error-trace">Error Trace</a></li><li><a href="#把-check-和-withdraw-放在一起">把 Check 和 Withdraw 放在一起</a></li></ul></li><li><a href="#temporal-properties-时间属性">Temporal Properties 时间属性</a></li><li><a href="#参考书籍">参考书籍</a></li></ul>

            </nav>
          </aside>
        
        <p>在一个小编程中测试tlaplus。</p>

<h2 id="电报问题描述">电报问题描述</h2>

<p>现在请你设计一个电报交换系统，包括以下几个条件：</p>

<ul>
  <li>每一个电报只能在银行中两个不同的人间进行传递，而且每个电报至少一美元。</li>
  <li>如果电报是成功的，那么电报的值便会从发送者方减去，而加在接收方的账户中。</li>
  <li>如果电报失败，两个账户将没有任何改变。</li>
  <li>电报不能让任何一个账户是负值。</li>
  <li>多个电报可能同时发生。</li>
</ul>

<h2 id="单进程建模">单进程建模</h2>

<h3 id="单进程代码">单进程代码</h3>

<pre><code class="language-PlusCal">EXTENDS Integers

(*--algorithm wire
variables
    people = {"Zhang", "Wang"},
    acc = [p \in people |-&gt; 5],
    sender = "Zhang",
    reciver = "Wang",
    amount \in 1..4;
        
define
        NoOverdrafts == \A p \in people: acc[p] &gt;= 0
end define;

begin
    Withdraw:
        acc[sender] := acc[sender] - amount;
    Deposite:
        acc[reciver] := acc[reciver] + amount;
end algorithm;**)
</code></pre>

<h3 id="报错情况设置">报错情况设置</h3>

<p>其中，如果修改 amount 的值为 范围 1..6，则会报错。</p>

<p>因为小张和小王的初始金额都是5，如果一次电报发送6美元，无论谁发都会出现负值。</p>

<p>不过有意思的是错误数量。</p>

<p>分别试试把 <code class="language-plaintext highlighter-rouge">amount</code> 设为 1..7，1..9看看吧。</p>

<p>可以看到的是，错误检测始终只报出一个错误，似乎是检测到错误就停止了。但是可区分的状态却有所不同。</p>

<ul>
  <li>Diameter，States Found，Distinct State，Queue Size分别是什么？有什么方法可以在无错状态下查看执行路径？</li>
</ul>

<h2 id="多进程处理">多进程处理</h2>

<h3 id="多进程代码">多进程代码</h3>

<pre><code class="language-PlusCal">EXTENDS Integers

(*--algorithm wire
variables
    people = {"Zhang", "Wang"},
    acc = [p \in people |-&gt; 5];
        
define
        NoOverdrafts == \A p \in people: acc[p] &gt;= 0
end define;

process Wire \in 1..2
    variables
        sender = "Zhang",
        reciver = "Wang",
        amount \in 1..acc[sender];

begin
    CheckFonds:
        if amount &lt;= acc[sender] then
            Withdraw:
                acc[sender] := acc[sender] - amount;
            Deposit:
                acc[reciver] := acc[reciver] + amount;
        end if;
end process;

end algorithm;**)

</code></pre>

<h3 id="error-trace">Error Trace</h3>

<p>执行上述代码，我们来看看 Error Trace 是什么样的吧。</p>

<p>看完这些，你会发现，pc代表机器所处的状态。</p>

<p>里面的两个值分别代表两个机器本身处于什么状态。</p>

<p>那么这整个堆栈显示了什么错误呢？</p>

<p>我们可以看到 amount 的值为<code class="language-plaintext highlighter-rouge">&lt;1, 5&gt;</code>，这意味着在该情形下，第一个进程要发1美元，第二个进程要发5美元过去。</p>

<p>而错误发生在第四步到第五步之间。发生了什么呢？</p>

<p>小张想给小王寄5美元钱，但是只有4美元，减去后发现账户余额变成负一美元。这种错误超过了<code class="language-plaintext highlighter-rouge">acc[p]&gt;0</code> 的约束条件。</p>

<p>而这五个步骤中整体发生了什么呢？</p>

<p>小张想给小王寄钱，在小王还没有收到钱时，小张第一次寄一美元，第二次寄五美元，账户变成负值。</p>

<h3 id="把-check-和-withdraw-放在一起">把 Check 和 Withdraw 放在一起</h3>

<p>那我们要怎样规避这些错误呢？</p>

<p>来看看教材给出的方案吧。</p>

<p>它把检查和账户减发送金额的步骤合在了一起。这样，当小张发送一美元完成检查时，由于金额一并被减去了，所以进程二检查时发送的金额不会再超过现有金额四美元。</p>

<pre><code class="language-tla+">EXTENDS Integers

(*--algorithm wire
variables
    people = {"Zhang", "Wang"},
    acc = [p \in people |-&gt; 5];
        
define
        NoOverdrafts == \A p \in people: acc[p] &gt;= 0
end define;

process Wire \in 1..2
    variables
        sender = "Zhang",
        reciver = "Wang",
        amount \in 1..acc[sender];

begin
    CheckAndWithDraw:
        if amount &lt;= acc[sender] then
                acc[sender] := acc[sender] - amount;
            Deposit:
                acc[reciver] := acc[reciver] + amount;
        end if;
end process;

end algorithm;**)


\* BEGIN TRANSLATION
</code></pre>

<p>现在没有问题了。</p>

<h2 id="temporal-properties-时间属性">Temporal Properties 时间属性</h2>

<p>之后要做什么？</p>

<p>整体金额不变的部分称为 <code class="language-plaintext highlighter-rouge">Temporal Properties</code> ，世俗的属性，时间的属性。而每次金额不变的属性称为 <code class="language-plaintext highlighter-rouge">invariants</code> ，也就是不变量。两者最大的区别目前看来是是否需要跨越不同的系统状态进行检查。 <code class="language-plaintext highlighter-rouge">invariants</code> 只需要在状态内检查属性就可以了。不过 <code class="language-plaintext highlighter-rouge">Temporal Properties</code> 则需要综合不同的系统状态考虑约束条件。</p>

<p>语法格式变得奇怪了。</p>

<p><code class="language-plaintext highlighter-rouge">EventuallyConsistent</code> ，最终不变的。</p>

<ul>
  <li>问题是在 <code class="language-plaintext highlighter-rouge">PlusCal</code> 中，<code class="language-plaintext highlighter-rouge">&lt;&gt;[]()</code> 是什么表达？</li>
</ul>

<p>来看看DuckDuckgo上有什么答案吧。</p>

<p>首先来解释 <code class="language-plaintext highlighter-rouge">&lt;&gt;[]P</code> 这个表达的含义吧。</p>

<p>根据<a href="https://www.learntla.com/core/temporal-logic.html">TLC手册</a>的表达，</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">语法</th>
      <th>含义</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">[]P</code></td>
      <td>P总为真</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">&lt;&gt;P</code></td>
      <td>P最终为真</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">[]~P</code></td>
      <td>P总为假</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">~[]P</code></td>
      <td>P不总为真，有假的情况</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">&lt;&gt;[]P</code></td>
      <td>最终P总为真（中间状态可以为假，但首尾状态应为真）</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">[]&lt;&gt;P</code></td>
      <td>P总最终为真</td>
    </tr>
  </tbody>
</table>

<p>看起来真是相当复杂的表述。</p>

<p>那么这种可能性中发生了什么呢？</p>

<p><img src="/assets/post_images/image-20240415192831616.png" alt="" /></p>

<ul>
  <li>恩……为什么小王没有收到最后一元呢？</li>
</ul>

<p>系统进行到第五步的时候出错了。</p>

<p>大概意思可能是，在状态4，进程2停止时，按照 <code class="language-plaintext highlighter-rouge">EventuallyConsistent</code> 的声明，系统总金额应该“最终”等于10。不过由于另一个进程的1元还没有送到，所以系统状态违反了时间属性的约束，就报错了。</p>

<ul>
  <li>那有什么处理方法吗？</li>
</ul>

<p>作者说，可以放松 <code class="language-plaintext highlighter-rouge">NoOverdrafts</code>或 <code class="language-plaintext highlighter-rouge">EventuallyConsistent</code>  条件，尝试不同的执行，告诉TLCplus在 <code class="language-plaintext highlighter-rouge">withdraw</code> 和 <code class="language-plaintext highlighter-rouge">deposit</code> 之间不能 <code class="language-plaintext highlighter-rouge">stutter</code>，或者干脆把 <code class="language-plaintext highlighter-rouge">check</code>，<code class="language-plaintext highlighter-rouge">withdraw</code> 和 <code class="language-plaintext highlighter-rouge">deposit</code> 三个步骤组成一个原子。</p>

<h2 id="参考书籍">参考书籍</h2>

<ul>
  <li>Pratical TLA+, by Hilllel Wayne</li>
</ul>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> 标签: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#%E5%BD%A2%E5%BC%8F%E5%8C%96%E9%AA%8C%E8%AF%81" class="page__taxonomy-item p-category" rel="tag">形式化验证</a>
    
    </span>
  </p>




        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> 更新时间:</strong> <time class="dt-published" datetime="2024-03-14T00:00:00+08:00">March 14, 2024</time></p>

      </footer>

      

      
  <nav class="pagination">
    
      <a href="/tlaplus-Pluscal/" class="pagination--pager" title="Tlaplus pluscal
">上一页</a>
    
    
      <a href="/tlaplus-%E6%93%8D%E4%BD%9C%E7%AC%A6%E5%92%8C%E5%87%BD%E6%95%B0/" class="pagination--pager" title="Tlaplus：操作符和函数
">下一页</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h2 class="page__related-title">猜您还喜欢</h2>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/hbase-%E9%85%8D%E7%BD%AE-(%E5%A4%B1%E8%B4%A5)/" rel="permalink">Hbase 配置 (失败)
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2024-04-15T00:00:00+08:00">April 15, 2024</time>
      </span>
    

    

    
  </p>


    <p class="archive__item-excerpt" itemprop="description">目标
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/tlaplus-%E6%93%8D%E4%BD%9C%E7%AC%A6%E5%92%8C%E5%87%BD%E6%95%B0/" rel="permalink">Tlaplus：操作符和函数
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2024-04-12T00:00:00+08:00">April 12, 2024</time>
      </span>
    

    

    
  </p>


    <p class="archive__item-excerpt" itemprop="description">了解一下 tlaplus 的操作符和函数。
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/tlaplus-Pluscal/" rel="permalink">Tlaplus pluscal
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2024-03-13T00:00:00+08:00">March 13, 2024</time>
      </span>
    

    

    
  </p>


    <p class="archive__item-excerpt" itemprop="description">探索一下 tlaplus pluscal 的基本功能。
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/calibre-server-%E9%85%8D%E7%BD%AE/" rel="permalink">Calibre server 配置
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2024-02-25T00:00:00+08:00">February 25, 2024</time>
      </span>
    

    

    
  </p>


    <p class="archive__item-excerpt" itemprop="description">calibre-server是一种非常便利的线上电子阅读服务。
之前的服务器到期了，现在重新配置了calibre-server，整理一下操作步骤。
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      输入您要搜索的关键词...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="输入您要搜索的关键词..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->
<!-- end custom footer snippets -->

        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>关注:</strong></li>
    

    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2024 甲与. 技术来自于 <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
